---
title: "家庭网络环境"
tags: ["网络", "配置"]
categories: ["瞎折腾"]
date: 2022-05-27T14:04:08Z
draft: false
---
随着家庭的联网设备增加，自己对于网络要求的提升，一天天的折腾着家里网络的配置。在2016年的时候，我采用的方案是All in one，在一台[J3160](https://ark.intel.com/content/www/us/en/ark/products/91533/intel-celeron-processor-j3160-2m-cache-up-to-2-24-ghz.html)(8G)机器上安装了Win10(通过Kodi播放视频)，在Hyper-V跑pfSense(软路由)，黑群。在当时200兆宽带的情况下，这个配置使用下来基本够用。

<!--more-->
## 一分为二

到了2019年的时候，公司淘汰了一台[i6700](https://ark.intel.com/content/www/us/en/ark/products/88196/intel-core-i76700-processor-8m-cache-up-to-4-00-ghz.html)(16G)的机器，为了发挥它的余热就把J3160替换了下来。由于J3160不再需要跑Win10了，所以就直接把黑群装在物理机上。i6700则是代替J3160安装了Win10用于播放视频，继续在Hyper-V中跑pfSense。后来家里安装了一些Sonoff的智能开关，刷的[Tasmota](https://tasmota.github.io/docs/)固件，于是在Hyper-V中又安装了[Home Assistant](https://www.home-assistant.io/)。为了在电视盒子上方便的看Youtube, 于是又安装了OpenWRT作为旁路由。作为一名程序员，多多少少是需要部署几个docker的。再加上对Linux平台的开发需求，这台i6700上就跑了这些系统。
- Win10
- pfSense
- OpenWRT
- Home Assistant
- Ubuntu 20.04 (docker)
- Proxmox VE + LXC (套娃形式快速创建不同系统)

## 更换主系统

久而久之，对这套系统产生了各种点点滴滴的不满意。这些问题仔细想想也没多大问题，可能是爱折腾的心让我最终选择了更换主系统。
- Win10的自动更新策略导致一个月至少重启一次
- 16G的内存偶尔会爆满导致部分虚拟机无法开启，不得不手动重启主机
- 入了Apple TV后几乎没再使用Kodi播放视频
- 下载的时候会使一个核的使用率达到100%，即使网速还没达到千兆
- 心水Proxmox VE的LXC，然而因为可用的内存有限所以一直没机会深入折腾

新的主系统选用的是Proxmox VE，原因是在Hyper-V里已经安装使用过一段时间比较熟悉了，所以没再尝试Esxi和Unraid。自从更换系统以来已经有一个多月，反反复复折腾了各种系统，最终稳定下来后家庭的网络环境如下图，后续再慢慢记录中间的折腾过程吧。
![homelab](/img/homelab.svg)
