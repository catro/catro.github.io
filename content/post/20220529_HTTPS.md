---
title: "在局域网中部署HTTPS"
tags: ["网络", "配置"]
categories: ["网络"]
date: 2022-05-29T14:40:11Z
draft: true
---
HTTPS是指HTTP over TLS，主要是为了提升HTTP协议栈的安全性。众所周知，HTTP本身是基于TCP/IP，从浏览器到网站之间的数据都是通过明文传输。明文传输就可能存在数据被篡改以及隐私泄漏的风险。TLS通过证书认证，通信加密以及摘要算法保证了端到端之间的安全性。HTTPS已经被广泛的应用到了因特网上，如果访问的哪个网站没有启用HTTPS那么主流的浏览器就会给予用户提示潜在的风险。随着越来越多的智能设备接入到局域网中，局域网的网络安全往往是大家容易忽视的地方。

<!--more-->
**家庭网络分析**
局域网中只要有任意设备上运行着不安全程序，那么直接访问局域网中部署的HTTP网站就可能被监听账号密码和隐私数据。在我的家庭网络中，很多服务都是需要通过Web来进行设置，那么启用全网站的HTTPS就上刻不容缓了。

在上篇[文章](/post/20220527_home_lab/)中已经介绍了我目前的网络配置，有这些服务是需要启用HTTPS的。
1. Proxmox VE
1. pfSense
1. OpenWRT
1. NAS
1. Docker
  1. Web server Caddy
  1. Portainer
  1. Gitea
  1. Home Assistant

启用HTTPS主要是需要申请以及部署服务器证书。对于这么多个站点，如果需要定时的手工申请和部署那肯定是不现实的。Docker里的几个服务器上可以通过Caddy进行方向代理。因为数据不会离开Docker环境，所以方向代理过程中发送的明文数据不会被局域网中其它设备监听到。所以最终就剩下5个服务器需要进行操作。目前最常见的自动化部署方案当属通过ACME申请和部署Let's encrypt的证书。这个方案在我的大部分服务中都有支持，但是我没有选择这个完整的方案，原因如下，
1. 这个方案需要拥有一个自己的域名。虽然我自己有不少域名，但是在局域网中还是希望能使用一个简短的域名(比如.lan)来方便内部访问。
1. 证书的有效期比较短，通常为三个月。之前尝试过使用正式运命，由于在部分服务上出现过没成功续签导致网站无法访问，所以还是希望能够有个至少一年的证书有效期。
1. 内部网站只能通过DNS挑战来签发证书，我并不希望所有的服务都能够有直接操作域名的权限。

**可行方案分析**
既然使用了私有域名，那么就需要有自己的证书管理体系了。